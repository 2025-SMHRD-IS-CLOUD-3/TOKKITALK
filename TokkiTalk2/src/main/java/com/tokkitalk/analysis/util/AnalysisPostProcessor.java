package com.tokkitalk.analysis.util;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.Random;
import java.util.stream.Collectors;

import com.tokkitalk.analysis.dto.AnalysisOut;
import com.tokkitalk.analysis.dto.AnalysisOut.Suggestion;

public class AnalysisPostProcessor {
    
    /**
     * ì œì•ˆ ê°œìˆ˜ë¥¼ ëœë¤ìœ¼ë¡œ ì„ íƒ (3~4ê°œ)
     */
    public static List<Suggestion> pickRandom(List<Suggestion> in) {
        if (in == null) in = new ArrayList<>();
        Collections.shuffle(in);
        int max = Math.min(4, in.size());
        int min = Math.min(3, max);                 // ìµœì†Œ 3ê°œ ë³´ì¥
        int n = (max >= 3) ? (new Random().nextInt(max - min + 1) + min) : max;
        return in.stream().limit(n).collect(Collectors.toList());
    }
    
    /**
     * ìµœì†Œ 3ê°œ ë³´ì¥ (ë¶€ì¡±í•˜ë©´ íœ´ë¦¬ìŠ¤í‹±ìœ¼ë¡œ ë³´ì¶©)
     */
    public static List<Suggestion> fallbackIfTooFew(List<Suggestion> in, AnalysisOut a) {
        if (in == null) in = new ArrayList<>();
        while (in.size() < 3) {                     // ìµœì†Œ 3ê°œ ë³´ì¥
            in.addAll(makeHeuristic(a));              // íœ´ë¦¬ìŠ¤í‹±ë¡œ ë³´ì¶©
            in = in.stream().distinct().limit(4).collect(Collectors.toList());
        }
        return in;
    }
    
    /**
     * íœ´ë¦¬ìŠ¤í‹± ì œì•ˆ ìƒì„± - ì—¬ìì–´ ë²ˆì—­ê¸°ì— ë§ëŠ” ì œì•ˆ
     */
    public static List<Suggestion> makeHeuristic(AnalysisOut a) {
        String mood = (a != null && a.emotion != null) ? a.emotion.label : "ì¤‘ë¦½";
        String surf = (a != null && a.surface != null) ? a.surface : "";
        
        // ìƒí™©ì— ë”°ë¥¸ ë‹¤ì–‘í•œ ì œì•ˆ ìƒì„±
        List<Suggestion> suggestions = new ArrayList<>();
        
        // í™•ì¥ëœ ë°ì´í„°ì…‹ ê¸°ë°˜ì˜ ë‹¤ì–‘í•œ ì œì•ˆ (ë” êµ¬ì²´ì ì´ê³  ê¸´ ì œì•ˆë“¤)
        suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ì™„ì „ ì˜ˆë»! ìƒ‰ê¹”ì´ ë„ˆí•œí…Œ ì˜ ì–´ìš¸ë ¤ âœ¨ ì–´ë””ì„œ ìƒ€ì–´?"));
        suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "ë§ì´ í˜ë“¤ì—ˆêµ¬ë‚˜, ê³ ìƒí–ˆì–´ ğŸ˜ ë‚´ê°€ ì˜†ì—ì„œ ì‰¬ê²Œ í•´ì¤„ê²Œ"));
        suggestions.add(s("ì¬ì¹˜ìˆëŠ” ì‘ë‹µí˜•", "ìœ„í—˜í•œ ì§ˆë¬¸ì´ë„¤ ğŸ˜‚ ë‚œ ì´ê±° í•œ í‘œ! ê¸°ë¶„ì— ë§ì¶° ì •í•˜ì!"));
        suggestions.add(s("êµ¬ì²´ì í–‰ë™í˜•", "ë‚´ê°€ ë§›ìˆëŠ” ê±°ë¼ë„ ì‚¬ì¤„ê¹Œ? ğŸ• ì˜¤ëŠ˜ì€ íŠ¹ë³„íˆ ì˜ˆì˜ë‹ˆê¹Œ"));
        suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "í˜ë“¤ë©´ ê´œì°®ì§€ ì•Šì•„ë„ ë¼. ë‚´ê°€ ìˆì–ì•„ ì–¸ì œë“  ë§í•´ì¤˜"));
        suggestions.add(s("ì¬ì¹˜ìˆëŠ” ì‘ë‹µí˜•", "ì˜¤ëŠ˜ì€ ë‚´ê°€ ë‹¤ í• ê²Œ, ë„Œ ì‰¬ì–´ ğŸ˜´ ë‚´ê°€ ì˜†ì—ì„œ ëŒë´ì¤„ê²Œ"));
        
        // í™•ì¥ëœ ë°ì´í„°ì…‹ ê¸°ë°˜ ê°ì •ë³„ ì¶”ê°€ ì œì•ˆ
        if (mood != null && !mood.equals("ì¤‘ë¦½")) {
            if (mood.contains("ê³ ë¯¼") || mood.contains("ë¶ˆì•ˆ")) {
                suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "ê´œì°®ì•„, ì²œì²œíˆ ìƒê°í•´ë´. ë‚´ê°€ ê¸°ë‹¤ë¦´ê²Œ ğŸ˜Š"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ê·¸ëŸ° ë§ˆìŒì´ ë“œëŠ” ê²Œ ë‹¹ì—°í•´. ë‚´ê°€ ì´í•´í•´ ğŸ’•"));
            } else if (mood.contains("ê¸°ëŒ€") || mood.contains("í˜¸ê¸°ì‹¬")) {
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ë¬´ì—‡ì„ ê¸°ëŒ€í•˜ê³  ìˆëŠ”ì§€ ê¶ê¸ˆí•´! ë§í•´ì¤˜ ğŸ˜Š"));
                suggestions.add(s("ì¬ì¹˜ìˆëŠ” ì‘ë‹µí˜•", "ë‚˜ë„ í•¨ê»˜ ê¸°ëŒ€í•˜ê³  ìˆì–´! ì–´ë–¤ ì¼ì´ì•¼? âœ¨"));
            } else if (mood.contains("í”¼ê³¤") || mood.contains("ìŠ¤íŠ¸ë ˆìŠ¤")) {
                suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "í¸í•˜ê²Œ ì‰¬ì–´. ë‚´ê°€ ë°©í•´í•˜ì§€ ì•Šì„ê²Œ ğŸ˜´"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "í˜ë“¤ ë•ŒëŠ” ë‚´ê°€ ìˆì–´. ì–¸ì œë“  ë§í•´ì¤˜ ğŸ’ª"));
            } else if (mood.contains("ê¶ê¸ˆ") || mood.contains("í˜¸ê¸°ì‹¬")) {
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ê¶ê¸ˆí•œ ê²Œ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë´! ë‚´ê°€ ì•Œë ¤ì¤„ê²Œ ğŸ˜Š"));
                suggestions.add(s("ì¬ì¹˜ìˆëŠ” ì‘ë‹µí˜•", "í•¨ê»˜ ì•Œì•„ë³´ì! ë­ê°€ ê¶ê¸ˆí•œì§€ ë§í•´ì¤˜ ğŸ”"));
            } else if (mood.contains("ì„œìš´í•¨") || mood.contains("ìŠ¬í””")) {
                suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "ë¯¸ì•ˆí•´, ë‚´ê°€ ì˜ëª»í–ˆì–´. í™” í’€ì–´"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ë­ê°€ ì†ìƒí–ˆì–´? ë§í•´ì¤˜"));
            } else if (mood.contains("ì§ˆíˆ¬") || mood.contains("ë¶ˆì•ˆ")) {
                suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "ì¬ë°Œê¸´ í–ˆì§€ë§Œ ë„ˆ ìƒê° ë§ì´ ë‚¬ì–´"));
                suggestions.add(s("ì¬ì¹˜ìˆëŠ” ì‘ë‹µí˜•", "ì§ˆíˆ¬í•˜ëŠ” ê±°ì•¼? ê·€ì—½ë„¤ ğŸ˜"));
            } else if (mood.contains("ë¶„ë…¸") || mood.contains("í™”ë‚¨")) {
                suggestions.add(s("ìœ„ë¡œÂ·ê³µê°í˜•", "í™”ë‚¬êµ¬ë‚˜ ğŸ˜… ë‚´ê°€ ì–´ë–»ê²Œ í• ê¹Œ?"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ì§„ì§œ ê´œì°®ì•„? ë¬´ë¦¬í•˜ì§€ ë§ê³  ë§í•´ì¤˜"));
            }
        }
        
        // ì—­ì„¤ì  ìƒí™© íŠ¹í™” ì œì•ˆë“¤ ì¶”ê°€
        if (surf != null && !surf.isEmpty()) {
            if (surf.contains("ê´œì°®ì•„") || surf.contains("ê´œì°®ë‹¤ê³ ")) {
                suggestions.add(s("ì ê·¹ëŒ€ì‘í˜•", "ê´œì°®ì§€ ì•Šì€ ê²ƒ ê°™ì€ë°? ë‚´ê°€ ë­˜ ì˜ëª»í–ˆëŠ”ì§€ ë§í•´ì¤˜"));
                suggestions.add(s("ê³µê°ì ‘ê·¼í˜•", "ê´œì°®ë‹¤ê³  í•˜ì§€ë§Œ í‘œì •ì´ ì•ˆ ê´œì°®ì•„ ë³´ì—¬. ì˜†ì— ìˆì–´ë„ ë ê¹Œ?"));
                suggestions.add(s("ì§ì ‘í–‰ë™í˜•", "ê´œì°®ë‹¤ëŠ” ë§ ë¯¿ì„ ìˆ˜ ì—†ì–´. ì§€ê¸ˆ ë°”ë¡œ ë§Œë‚˜ì"));
                suggestions.add(s("ìœ ë¨¸ì™„í™”í˜•", "ê´œì°®ë‹¤ëŠ” ì—¬ìëŠ” ê´œì°®ì§€ ì•Šë‹¤ëŠ” ë²•ì¹™ ë°œë™! ë­ê°€ ì†ìƒí•´? ğŸ˜…"));
            } else if (surf.contains("ì•Œì•„ì„œ") || surf.contains("íŒë‹¨í•´")) {
                suggestions.add(s("ì ê·¹í•´ê²°í˜•", "ì•Œì•„ì„œ í•  ê²Œ ì•„ë‹ˆë¼ ê°™ì´ í•´ê²°í•˜ì. ë­ê°€ ë¬¸ì œì•¼?"));
                suggestions.add(s("ê´€ì‹¬ì§‘ì¤‘í˜•", "ì•Œì•„ì„œ í•˜ê¸°ë³´ë‹¤ëŠ” ë„¤ ì˜ê²¬ì´ ê¶ê¸ˆí•´. ì–´ë–»ê²Œ ìƒê°í•´?"));
                suggestions.add(s("í™”í•´ì‹œë„í˜•", "ì•Œì•„ì„œ í•˜ë¼ë‹ˆê¹Œ í™”ë‚œ ê±° ê°™ì€ë°, ë‚´ê°€ ë­˜ ì˜ëª»í–ˆì–´?"));
                suggestions.add(s("ëˆì§ˆí•œëŒ€í™”í˜•", "ì•Œì•„ì„œ í•˜ëŠ” ê±´ ë‚˜ì¤‘ì— í•˜ê³  ì§€ê¸ˆì€ ë„ˆë‘ ì–˜ê¸°í•˜ê³  ì‹¶ì–´"));
            } else if (surf.contains("ì‹ ê²½ì“°ì§€ë§ˆ") || surf.contains("ì‹ ê²½ ì•ˆ ì¨")) {
                suggestions.add(s("ë°˜ëŒ€í–‰ë™í˜•", "ì‹ ê²½ ì•ˆ ì“¸ ìˆ˜ê°€ ì—†ì–´. ë„ˆí•œí…Œ ê´€ì‹¬ ë§ê±°ë“ "));
                suggestions.add(s("ì§€ì†ê´€ì‹¬í˜•", "ì‹ ê²½ ì“°ì§€ ë§ë¼ê³ ? ë” ì‹ ê²½ ì“¸ ê±°ì•¼. ë­ê°€ ì†ìƒí•´?"));
                suggestions.add(s("ì†”ì§ëŒ€ì‘í˜•", "ì‹ ê²½ì“°ì§€ ë§ë¼ëŠ” ì‚¬ëŒí•œí…Œ ì™œ ë” ì‹ ê²½ ì“°ì´ì§€? ë¬´ìŠ¨ ì¼ì´ì•¼?"));
                suggestions.add(s("ìœ ë¨¸ì ì ‘ê·¼í˜•", "ì‹ ê²½ ì•ˆ ì“°ê¸° ë„ì „ ì‹¤íŒ¨! ê³„ì† ìƒê°ë‚˜ëŠ”ë° ì–´ë–¡í•´? ğŸ˜‚"));
            } else if (surf.contains("ëì–´") || surf.contains("ìŠì–´")) {
                suggestions.add(s("ì ê·¹ë§Œë¥˜í˜•", "ì•ˆ ëœë‹¤! í¬ê¸°í•˜ë©´ ì•ˆ ë¼. ë­ê°€ ë¬¸ì œì¸ì§€ ë§í•´ë´"));
                suggestions.add(s("ëˆì§ˆí•œì„¤ë“í˜•", "ëë‹¤ê³ ? ì „í˜€ ì•ˆ ëì–´. ê³„ì† í•˜ì, ë‚´ê°€ ë„ì™€ì¤„ê²Œ"));
                suggestions.add(s("ê°ì •ê³µê°í˜•", "í™”ë‚˜ì„œ ê·¸ëŸ¬ëŠ” ê±°ì§€? ê·¸ë˜ë„ í¬ê¸°í•˜ë©´ ì•„ì‰¬ìš¸ ê²ƒ ê°™ì€ë°"));
                suggestions.add(s("ëŒ€ì•ˆì œì‹œí˜•", "ì•ˆ í•˜ê¸°ë³´ë‹¤ëŠ” ë‹¤ë¥¸ ë°©ë²• ì°¾ì•„ë³´ì. ê°™ì´ ê³ ë¯¼í•´ë³¼ê¹Œ?"));
            } else if (surf.contains("í˜¼ì") || surf.contains("í˜¼ìì„œ")) {
                suggestions.add(s("ì ê·¹ì°¸ì—¬í˜•", "í˜¼ì í•˜ì§€ ë§ˆ, ë‚´ê°€ ë„ì™€ì¤„ê²Œ. ë­ë¶€í„° ì‹œì‘í• ê¹Œ?"));
                suggestions.add(s("ê°•ì œë™ì°¸í˜•", "í˜¼ì í•  ê±°ë©´ ë‚˜ë„ ì˜†ì—ì„œ í˜¼ì í• ê²Œ. ê°™ì´ í˜¼ì í•˜ì"));
                suggestions.add(s("ë¶€ë‹´ëœê¸°í˜•", "í˜¼ì í•˜ê¸° í˜ë“  ì¼ì´ì–ì•„. ë‚˜ë‘ ê°™ì´ í•˜ë©´ ë” ì‰¬ìš¸ í…ë°"));
                suggestions.add(s("ê´€ê³„ê°•ì¡°í˜•", "í˜¼ì í•˜ëŠ” ê±´ ì„œìš´í•´. ìš°ë¦¬ ì‚¬ì´ì— ë­˜ í˜¼ì í•´?"));
            } else if (surf.contains("ìƒê´€ì—†ì–´") || surf.contains("ìƒê´€ì—†ë‹¤")) {
                suggestions.add(s("ì§„ì‹¬íŒŒì•…í˜•", "ìƒê´€ì—†ë‹¤ëŠ” ë§íˆ¬ê°€ ìƒê´€ìˆì–´ ë³´ì´ëŠ”ë°? ì†”ì§íˆ ë§í•´ì¤˜"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ë„ˆí•œí…ŒëŠ” ìƒê´€ì—†ì–´ë„ ë‚˜í•œí…ŒëŠ” ìƒê´€ìˆì–´. ì–´ë–»ê²Œ ìƒê°í•´?"));
                suggestions.add(s("ë°˜ëŒ€ì¶”ì¸¡í˜•", "ìƒê´€ì—†ë‹¤ê³ ? í‘œì • ë³´ë‹ˆê¹Œ ì—„ì²­ ìƒê´€ìˆëŠ” ê²ƒ ê°™ì€ë° ğŸ˜"));
                suggestions.add(s("ì§€ì†ì§ˆë¬¸í˜•", "ìƒê´€ì—†ë‹¤ê³  í•˜ë‹ˆê¹Œ ë” ê¶ê¸ˆí•´ì ¸. ì •ë§ ê´œì°®ì€ ê±°ì•¼?"));
            } else if (surf.contains("ê·¸ëƒ¥") || surf.contains("ê·¸ëŸ° ê±°ì•¼")) {
                suggestions.add(s("ëˆì§ˆí•œì¶”ê¶í˜•", "ê·¸ëƒ¥ì´ë¼ëŠ” ê±´ ì—†ì–´. ì²œì²œíˆ ë§í•´ë´, ì‹œê°„ ë§ì•„"));
                suggestions.add(s("í¸ì•ˆí•œë¶„ìœ„ê¸°í˜•", "ê·¸ëƒ¥ì´ë¼ê³  í•˜ëŠ” ê±´ ë­”ê°€ ìˆë‹¤ëŠ” ëœ»ì´ì§€? í¸í•˜ê²Œ ë§í•´"));
                suggestions.add(s("ì¶”ì¸¡ì ‘ê·¼í˜•", "ê·¸ëƒ¥ì´ë¼ë‹ˆê¹Œ ë” ê¶ê¸ˆí•´. í˜¹ì‹œ ë‚´ê°€ ë­˜ ì˜ëª»í–ˆì–´?"));
                suggestions.add(s("ì¸ë‚´ì‹¬í‘œí˜„í˜•", "ê·¸ëƒ¥ì´ì–´ë„ ê´œì°®ì•„. ë§í•˜ê³  ì‹¶ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ê²Œ"));
            } else if (surf.contains("ì–´ì°¨í”¼") || surf.contains("ì¤‘ìš”í•˜ì§€ ì•Šìœ¼ë‹ˆê¹Œ")) {
                suggestions.add(s("ì¦‰ì‹œë°˜ë°•í˜•", "ë¬´ìŠ¨ ì†Œë¦¬ì•¼, ë„¤ ë§ì€ í•­ìƒ ë“¤ì–´ì¤˜. ë­”ë° ë§í•´ë´"));
                suggestions.add(s("ì§„ì‹¬í‘œí˜„í˜•", "ì•ˆ ë“¤ì–´ì¤€ë‹¤ê³ ? ë„¤ ë§ì´ ì œì¼ ì¤‘ìš”í•œë°. ë§í•´ì¤˜"));
                suggestions.add(s("ê°•ë ¥ë¶€ì •í˜•", "ë§ë„ ì•ˆ ë¼! ë„ˆëŠ” ë‚˜í•œí…Œ ì œì¼ ì¤‘ìš”í•œ ì‚¬ëŒì´ì•¼"));
                suggestions.add(s("êµ¬ì²´ì ì¦ëª…í˜•", "ì¤‘ìš”í•˜ì§€ ì•Šë‹¤ê³ ? ë„ˆ ë•Œë¬¸ì— ë‚´ê°€ ì–¼ë§ˆë‚˜ í–‰ë³µí•œì§€ ì•Œì•„?"));
            } else if (surf.contains("ìƒê°í•´ë³¼ê²Œ") || surf.contains("ê³ ë¯¼í•´ë³¼ê²Œ")) {
                suggestions.add(s("ì••ë°•ì™„í™”í˜•", "ì²œì²œíˆ ìƒê°í•´ë„ ë¼. ë¶€ë‹´ ê°–ì§€ ë§ê³ "));
                suggestions.add(s("ëŒ€ì•ˆì œì‹œí˜•", "ë‹¤ë¥¸ ë°©ë²•ë„ ìˆìœ¼ë‹ˆê¹Œ í¸í•œ ëŒ€ë¡œ í•´"));
                suggestions.add(s("ì†”ì§ìœ ë„í˜•", "ì†”ì§í•˜ê²Œ ë§í•´ë„ ê´œì°®ì•„. ë¬´ë¦¬í•˜ì§€ ë§ˆ"));
                suggestions.add(s("ì´í•´í‘œí˜„í˜•", "ê³ ë¯¼ë˜ëŠ” ê²Œ ìˆìœ¼ë©´ ì–˜ê¸°í•´ì¤˜"));
            } else if (surf.contains("ë‹¤ìŒì—") || surf.contains("ë‚˜ì¤‘ì—")) {
                suggestions.add(s("ì´í•´ìˆ˜ìš©í˜•", "ì•Œê² ì–´, ë„¤ê°€ í•˜ê³  ì‹¶ì„ ë•Œ í•˜ì"));
                suggestions.add(s("ë¶€ë‹´í•´ì†Œí˜•", "ê´œì°®ì•„, ê¸‰í•œ ê²Œ ì•„ë‹ˆë‹ˆê¹Œ ì²œì²œíˆ"));
                suggestions.add(s("ê´€ì‹¬ì§€ì†í˜•", "ë‹¤ìŒì— ê¼­ í•˜ì. ìŠì§€ ì•Šì„ê²Œ"));
                suggestions.add(s("ë°°ë ¤í‘œí˜„í˜•", "ì§€ê¸ˆ ë°”ì˜êµ¬ë‚˜. ì‹œê°„ ë‚  ë•Œ í¸í•˜ê²Œ"));
            } else if (surf.contains("ë³„ë¡œ ì•ˆ ì¤‘ìš”í•´") || surf.contains("ì¤‘ìš”í•˜ì§€ ì•Šì•„")) {
                suggestions.add(s("ì§„ì‹¬íŒŒì•…í˜•", "ì¤‘ìš”í•˜ì§€ ì•Šì€ ê²ƒ ê°™ì§€ ì•Šì€ë°? ì†”ì§íˆ ë§í•´ì¤˜"));
                suggestions.add(s("ì¤‘ìš”ì„±ì¸ì •í˜•", "ë‚˜í•œí…ŒëŠ” ì¤‘ìš”í•´. ë„¤ê°€ ì‹ ê²½ì“°ëŠ” ì¼ì´ë‹ˆê¹Œ"));
                suggestions.add(s("ì§€ì§€í‘œí˜„í˜•", "ì¤‘ìš”í•œ ì¼ì´ë©´ ê°™ì´ ìƒê°í•´ë³´ì"));
                suggestions.add(s("ì•ˆì „ê°ì œê³µí˜•", "ì¤‘ìš”í•˜ë‹¤ê³  ë§í•´ë„ ê´œì°®ì•„. ë‚˜ëŠ” ì´í•´í•´"));
            } else if (surf.contains("ëˆ„ê°€ ë” ì˜ˆë»") || surf.contains("ë¹„êµ")) {
                suggestions.add(s("í™•ì‹ ì£¼ê¸°í˜•", "ë¹„êµ ìì²´ê°€ ë§ì´ ì•ˆ ë¼. ë„ˆëŠ” ìœ ì¼í•´"));
                suggestions.add(s("ìœ„í—˜íšŒí”¼í˜•", "ë‘˜ ë‹¤ ê°ì ë§¤ë ¥ì´ ìˆì§€ë§Œ ë‚´ ë§ˆìŒì€ ì •í•´ì ¸ ìˆì–´"));
                suggestions.add(s("ì• ì •í‘œí˜„í˜•", "ì¹œêµ¬ë“  ëˆ„êµ¬ë“  ë„ˆë§Œí¼ ì˜ˆìœ ì‚¬ëŒì€ ì—†ì–´"));
                suggestions.add(s("ì§ˆë¬¸ëŒë¦¬ê¸°í˜•", "ì™œ ì´ëŸ° ì§ˆë¬¸í•´? ë„¤ê°€ ì œì¼ì¸ ê±° ëª¨ë¥´ë‚˜? ğŸ˜Š"));
            } else if (surf.contains("ë‹¤ë¥¸ ì—¬ì") || surf.contains("ì˜ˆì˜ë‹¤ê³ ")) {
                suggestions.add(s("ì•ˆì „ëŒ€ë‹µí˜•", "ë‹¤ë¥¸ ì—¬ìëŠ” ê´€ì‹¬ ì—†ì–´. ë„ˆë§Œ ë³´ì—¬"));
                suggestions.add(s("í•¨ì •ì¸ì‹í˜•", "ë§í•´ë„ ëœë‹¤ê³ ? ê·¸ëŸ° í•¨ì •ì— ì•ˆ ê±¸ë ¤ ğŸ˜"));
                suggestions.add(s("ì• ì •í™•ì‹ í˜•", "ì˜ˆìœ ì‚¬ëŒ ë§ì§€ë§Œ ë„ˆ ê°™ì€ ì‚¬ëŒì€ ì—†ì–´"));
                suggestions.add(s("ì§ˆë¬¸ë°˜ë°•í˜•", "ì™œ ì´ëŸ° ì§ˆë¬¸í•´? ë„¤ê°€ ìµœê³ ì¸ë° ë‹¤ë¥¸ ì‚¬ëŒì´ ì™œ í•„ìš”í•´?"));
            } else if (surf.contains("ì „ ì—¬ì¹œ") || surf.contains("ì´ì „")) {
                suggestions.add(s("ê³¼ê±°ì°¨ë‹¨í˜•", "ë¹„êµí•  ìˆ˜ ì—†ì–´. ë„ˆëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ì°¨ì›ì´ì•¼"));
                suggestions.add(s("í˜„ì¬ì§‘ì¤‘í˜•", "ê³¼ê±°ëŠ” ê³¼ê±°ê³ , ì§€ê¸ˆ ë‚´ ì˜†ì— ìˆëŠ” ê±´ ë„ˆì•¼"));
                suggestions.add(s("ìœ ì¼ì„±ê°•ì¡°í˜•", "ë¹„êµ ìì²´ê°€ ì˜ë¯¸ ì—†ì–´. ë„ˆëŠ” ëŒ€ì²´ ë¶ˆê°€ëŠ¥í•´"));
                suggestions.add(s("ì§ˆë¬¸ëŒë¦¬ê¸°í˜•", "ì™œ ê³¼ê±° ì–˜ê¸°ë¥¼? ì§€ê¸ˆì´ ì œì¼ í–‰ë³µí•œë°"));
            } else if (surf.contains("ì‹œí°ë‘¥") || surf.contains("ê´€ì‹¬ ì—†ì–´")) {
                suggestions.add(s("ì¦‰ì‹œë¶€ì •í˜•", "ì‹œí°ë‘¥í•˜ê¸´! ë„ˆí•œí…Œ ëŠ˜ ê´€ì‹¬ ë§ì•„"));
                suggestions.add(s("í–‰ë™ê°œì„ í˜•", "ê·¸ë ‡ê²Œ ëŠê¼ˆë‹¤ë©´ ë¯¸ì•ˆí•´. ì•ìœ¼ë¡œ ë” í‘œí˜„í• ê²Œ"));
                suggestions.add(s("ì• ì •ì¬í™•ì¸í˜•", "ì‹œí°ë‘¥í•  ë¦¬ ì—†ì–ì•„. ë„ˆ ì—†ìœ¼ë©´ ì•ˆ ë˜ëŠ”ë°"));
                suggestions.add(s("êµ¬ì²´ì ê³„íší˜•", "ìš”ì¦˜ ë°”ë¹ ì„œ ê·¸ë¬ë‚˜? ì£¼ë§ì— ì‹œê°„ ë‚´ì„œ ë°ì´íŠ¸í•˜ì"));
            } else if (surf.contains("ì˜ ì‚´") || surf.contains("ì—†ì–´ë„")) {
                suggestions.add(s("ê°•ë ¥ê±°ë¶€í˜•", "ë§ë„ ì•ˆ ë¼! ë„ˆ ì—†ìœ¼ë©´ ì§„ì§œ ëª» ì‚´ì•„"));
                suggestions.add(s("êµ¬ì²´ì ì„¤ëª…í˜•", "ì˜ ì‚´ê¸°ëŠ” ë¬´ìŠ¨, ë„ˆ ë•Œë¬¸ì— ë‚´ê°€ í–‰ë³µí•œ ê±´ë°"));
                suggestions.add(s("ì¼ìƒì¦ëª…í˜•", "í•˜ë£¨ë„ ë„ˆ ìƒê° ì•ˆ í•˜ëŠ” ë‚ ì´ ì—†ëŠ”ë° ë¬´ìŠ¨ ì†Œë¦¬ì•¼"));
                suggestions.add(s("ë¯¸ë˜ì•½ì†í˜•", "ì—†ì–´ë„ ëœë‹¤ëŠ” ìƒê° ë²„ë ¤. í‰ìƒ í•¨ê»˜ í•  ê±°ì•¼"));
            } else if (surf.contains("ì¢‹ì€ ì‚¬ëŒ") || surf.contains("ë‚˜ë³´ë‹¤")) {
                suggestions.add(s("ìœ ì¼ì„±ê°•ì¡°í˜•", "ì¢‹ì€ ì‚¬ëŒì€ ë§ì•„ë„ ë„ˆ ê°™ì€ ì‚¬ëŒì€ ì—†ì–´"));
                suggestions.add(s("ì„ íƒí™•ì‹ í˜•", "ë‚´ê°€ ë„ˆë¥¼ ì„ íƒí•œ ì´ìœ ê°€ ìˆì–´. ë„ˆëŠ” íŠ¹ë³„í•´"));
                suggestions.add(s("ë¹„êµê±°ë¶€í˜•", "ë‹¤ë¥¸ ì‚¬ëŒê³¼ ë¹„êµí•  ìˆ˜ ì—†ì–´. ë„ˆëŠ” ìœ ì¼í•´"));
                suggestions.add(s("ë¯¸ë˜í™•ì•½í˜•", "ë” ì¢‹ì€ ì‚¬ëŒì´ ìˆì–´ë„ ë‚œ ë„ˆë§Œ ì›í•´"));
            } else if (surf.contains("ì—°ë½ì´ ëœ¸í•´") || surf.contains("ì—°ë½ ì•ˆ í•´")) {
                suggestions.add(s("ì¦‰ì‹œê°œì„ í˜•", "ë¯¸ì•ˆí•´, ë°”ë¹ ì„œ ê·¸ë¬ì–´. ì•ìœ¼ë¡œ ë” ìì£¼ í• ê²Œ"));
                suggestions.add(s("íŒ¨í„´ê°œì„ í˜•", "ë§ë„¤, ì•ìœ¼ë¡œ ë§¤ì¼ ì•ˆë¶€ ì¸ì‚¬í•˜ì"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ì—°ë½ ëª»í•œ ì‚¬ì´ì—ë„ ë„ˆ ìƒê° ë§ì´ í–ˆì–´"));
                suggestions.add(s("ì•½ì†ì œì‹œí˜•", "ì•„ì¹¨ì €ë…ìœ¼ë¡œ ì•ˆë¶€ í™•ì¸í•˜ëŠ” ìŠµê´€ ë§Œë“¤ì"));
            } else if (surf.contains("í˜¼ì ìˆëŠ” ì‹œê°„") || surf.contains("í˜¼ì ë³´ë‚´ëŠ”")) {
                suggestions.add(s("ì¦‰ì‹œì œì•ˆí˜•", "ê·¸ëŸ¼ ê°™ì´ ìˆì! ì§€ê¸ˆ ì‹œê°„ ìˆì–´?"));
                suggestions.add(s("ê³„íšì œì‹œí˜•", "ì™¸ë¡­ê² ë„¤. ì´ë²ˆ ì£¼ë§ì— ê°™ì´ ë­ í• ê¹Œ?"));
                suggestions.add(s("ë™ë°˜ì˜ì§€í˜•", "í˜¼ì ìˆì§€ ë§ê³  ì–¸ì œë“  ë¶ˆëŸ¬. ë°”ë¡œ ê°„ê²Œ"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "í˜¼ì ìˆìœ¼ë©´ ë­ í•´? ì¬ë¯¸ìˆëŠ” ê±° ê°™ì´ ì°¾ì•„ë³´ì"));
            } else if (surf.contains("ì»¤í”Œë¡œ") || surf.contains("ë‹¤ë“¤ ë‚˜ê°€")) {
                suggestions.add(s("ì¦‰ì‹œì‘ë‹µí˜•", "ê·¸ëŸ¼ ìš°ë¦¬ë„ ë‚˜ê°€ì! ì–´ë”” ê°€ê³  ì‹¶ì–´?"));
                suggestions.add(s("íŠ¹ë³„ê³„íší˜•", "ì»¤í”Œë¡œ ë‚˜ê°„ë‹¤ê³ ? ìš°ë¦¬ê°€ ì œì¼ ë©‹ì§„ ì»¤í”Œì´ ë˜ì"));
                suggestions.add(s("ë™ì°¸ì˜ì§€í˜•", "ìš°ë¦¬ë„ ì»¤í”Œ ë°ì´íŠ¸ ì½”ìŠ¤ ì°¾ì•„ë³´ì"));
                suggestions.add(s("ë…íŠ¹í•¨ê°•ì¡°í˜•", "ë‚¨ë“¤ ë”°ë¼í•˜ì§€ ë§ê³  ìš°ë¦¬ë§Œì˜ íŠ¹ë³„í•œ ë°ì´íŠ¸ í•˜ì"));
            } else if (surf.contains("í™” ì•ˆ ë‚¬ì–´") || surf.contains("í™” ì•ˆ ë‚¬ë‹¤")) {
                suggestions.add(s("ì§„ì‹¤íŒŒì•…í˜•", "í™” ì•ˆ ë‚¬ë‹¤ëŠ” ë§íˆ¬ê°€ í™”ë‚œ ê²ƒ ê°™ì€ë°? ë­ê°€ ì†ìƒí•´?"));
                suggestions.add(s("ì„ ì œì‚¬ê³¼í˜•", "í™” ì•ˆ ë‚¬ë‹¤ê³  í•´ë„ ë‚´ê°€ ë­”ê°€ ì˜ëª»í•œ ê²ƒ ê°™ì•„. ë¯¸ì•ˆí•´"));
                suggestions.add(s("ê´€ì‹¬ì§‘ì¤‘í˜•", "í™” ë‚¬ë“  ì•ˆ ë‚¬ë“  ì¼ë‹¨ ì–˜ê¸°í•´ë³´ì. ë­ê°€ ë¬¸ì œì•¼?"));
                suggestions.add(s("ëˆì§ˆí•œê´€ì‹¬í˜•", "í™” ì•ˆ ë‚¬ë‹¤ë‹ˆê¹Œ ë” ê¶ê¸ˆí•´. ì§„ì§œ ê´œì°®ì€ ê±° ë§ì•„?"));
            } else if (surf.contains("ë³„ì¼ ì•„ë‹ˆì•¼") || surf.contains("ëŒ€ìˆ˜ë¡­ì§€ ì•Šì•„")) {
                suggestions.add(s("ì¤‘ìš”ì„±ì¸ì •í˜•", "ë³„ì¼ ì•„ë‹ˆë¼ê³ ? ë„ˆí•œí…Œ ì¼ì–´ë‚œ ì¼ì€ ë‹¤ ì¤‘ìš”í•´"));
                suggestions.add(s("ê´€ì‹¬í‘œí˜„í˜•", "ë³„ì¼ ì•„ë‹ˆì–´ë„ ê¶ê¸ˆí•´. ë¬´ìŠ¨ ì¼ì¸ì§€ ë§í•´ì¤˜"));
                suggestions.add(s("ì§€ì†ê´€ì‹¬í˜•", "ë³„ì¼ ì•„ë‹ˆë¼ê³  í•´ë„ ê³„ì† ì‹ ê²½ ì“°ì¼ ê²ƒ ê°™ì€ë°"));
                suggestions.add(s("ì§„ì‹¬íŒŒì•…í˜•", "ë³„ì¼ ì•„ë‹ˆë¼ëŠ” ë§ì´ ë³„ì¼ ê°™ë‹¤ëŠ” ëœ» ì•„ë‹ˆì•¼?"));
            } else if (surf.contains("ê¸°ë¶„ì´ ì•ˆ ì¢‹ì•„") || surf.contains("ê¸°ë¶„ ë‚˜ë¹ ")) {
                suggestions.add(s("ì›ì¸íƒìƒ‰í˜•", "ê·¸ëƒ¥ ê¸°ë¶„ ë‚˜ì  ë¦¬ ì—†ì–´. ë¬´ìŠ¨ ì¼ ìˆì—ˆì–´?"));
                suggestions.add(s("ê³µê°ì ‘ê·¼í˜•", "ê¸°ë¶„ ì•ˆ ì¢‹êµ¬ë‚˜. ë¬´ì—‡ ë•Œë¬¸ì¸ì§€ ì–˜ê¸°í•´ì¤„ë˜?"));
                suggestions.add(s("ìœ„ë¡œì œê³µí˜•", "ê¸°ë¶„ ì•ˆ ì¢‹ì€ ë‚ ì´ ìˆì§€. ë‚´ê°€ ì˜†ì— ìˆì„ê²Œ"));
                suggestions.add(s("í•´ê²°ì˜ì§€í˜•", "ê¸°ë¶„ ë‚˜ìœ ì´ìœ  ì°¾ì•„ì„œ ê°™ì´ í•´ê²°í•´ë³´ì"));
            } else if (surf.contains("ìš°ë¦¬ ì‚¬ì´") || surf.contains("ê´€ê³„")) {
                suggestions.add(s("ê¸ì •í™•ì‹ í˜•", "ì™„ì „ ì¢‹ì•„! ë„ˆì™€ í•¨ê»˜ì—¬ì„œ ë§¤ì¼ í–‰ë³µí•´"));
                suggestions.add(s("ë°œì „ì˜ì§€í˜•", "ì§€ê¸ˆë„ ì¢‹ì§€ë§Œ ì•ìœ¼ë¡œ ë” ì¢‹ì•„ì§ˆ ê²ƒ ê°™ì•„"));
                suggestions.add(s("íŠ¹ë³„ê°•ì¡°í˜•", "ìš°ë¦¬ ì‚¬ì´ëŠ” íŠ¹ë³„í•´. ì´ëŸ° ê´€ê³„ ì²˜ìŒì´ì•¼"));
                suggestions.add(s("ë¯¸ë˜ì§€í–¥í˜•", "ì§€ê¸ˆ ì™„ë²½í•´. ê³„ì† ì´ë ‡ê²Œ í•¨ê»˜ í•˜ê³  ì‹¶ì–´"));
            }
        }
        
        return suggestions;
    }
    
    private static Suggestion s(String style, String text) {
        Suggestion r = new Suggestion();
        r.style = style;
        r.text = text;
        return r;
    }
    
    /**
     * AnalysisOut ìœ íš¨ì„± ê²€ì‚¬ ë° ë³´ì •
     */
    public static void validateAndFix(AnalysisOut out) {
        // ê°ì • ê¸°ë³¸ê°’ ë³´ì •
        if (out.emotion == null || out.emotion.intensity == null) {
            AnalysisOut.Emotion e = new AnalysisOut.Emotion();
            e.label = "ì¤‘ë¦½";
            e.intensity = 2;
            out.emotion = e;
        }
        
        // ì œì•ˆ ê°œìˆ˜ ëœë¤(3~4) + ìµœì†Œ 3ê°œ ë³´ì¥
        List<Suggestion> picked = pickRandom(out.advice);
        picked = fallbackIfTooFew(picked, out);
        out.advice = picked;
        
        // ì‹ ë¢°ë„ ê¸°ë³¸ê°’
        if (out.confidence == null) {
            out.confidence = 75;
        }
        
        // risk_flags ê¸°ë³¸ê°’
        if (out.risk_flags == null) {
            out.risk_flags = new ArrayList<>();
        }
    }
}
